<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Capítulo 2: Importación y Manipulación de Datos en R</title>
    <meta charset="utf-8" />
    <meta name="author" content="LINDA CABRERA ORELLANA FERNANDA JURADO MANTILLA" />
    <script src="libs/header-attrs-2.17/header-attrs.js"></script>
    <link href="libs/tile-view-0.2.6/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view-0.2.6/tile-view.js"></script>
    <script src="libs/clipboard-2.0.6/clipboard.min.js"></script>
    <link href="libs/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"Copy Code","success":"Copied!","error":"Press Ctrl+C to Copy"})</script>
    <link href="libs/shareon-1.4.1/shareon.min.css" rel="stylesheet" />
    <script src="libs/shareon-1.4.1/shareon.min.js"></script>
    <link href="libs/xaringanExtra-shareagain-0.2.6/shareagain.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-shareagain-0.2.6/shareagain.js"></script>
    <link href="libs/panelset-0.2.6/panelset.css" rel="stylesheet" />
    <script src="libs/panelset-0.2.6/panelset.js"></script>
    <link rel="stylesheet" href="theme-masapp.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">





class: center, middle, titular
background-size: contain

&lt;img style="border-radius: 50%;" src="img/masapp.jpg" width="250px"/&gt;
# Capítulo 2: Importación y Manipulación de Datos en R 
## **CAPACITACIÓN**
#### LINDA CABRERA ORELLANA&lt;br&gt;FERNANDA JURADO MANTILLA
#### Noviembre, 2022

---



# Contenido del Capítulo 2

.pull-left[
- Proceso del tidyverse

- Importar datos
   * Importar archivos `.csv`
   * Importar y exportar desde Excel
   * Otros archivos

- Estructuras de datos
   * Vectores
   * Data.frames (Tibbles)
   * Funciones básicas
   * Práctica 2.1

- Tipos de datos
   * Numéricos
   * Cadena de caracteres
   * Factores
   * Fechas y Horas
   * Práctica 2.2
]

.pull-right[ 
- Datos relacionales con `dplyr`
   * Operador pipe `%&gt;%`
   * Mutating joins
   * Filtering joins
   * Set operations
   * Práctica 2.3

- Datos ordenados con `tidyr`
   * Ordenar datos a lo largo
   * Ordenar datos a lo ancho
   * Práctica 2.4
   
- Transformación de datos con `dplyr`
   * Modificar el nombre de las variables
   * Seleccionar o descartar variables
   * Filtrar observaciones
   * Agregar o editar variables
   * Resumir información
   * Agrupar o segmentar datos
]

---

## Proceso del *tidyverse*

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="img/proceso.png" alt="Figura 1. Proceso del tidyverse" width="100%" /&gt;
&lt;p class="caption"&gt;Figura 1. Proceso del tidyverse&lt;/p&gt;
&lt;/div&gt;


.footnote[ [Understanding the Data Science Lifecycle](https://www.sudeep.co/data-science/2018/02/09/Understanding-the-Data-Science-Lifecycle.html) || [8 Ways to Improve Decision Making](https://www.anblicks.com/blog/8-ways-to-improve-decision-making-and-cut-cost-with-better-data-quality)]


---

## Paquetes a utilizar

* <svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M374.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 178.7l-57.4-57.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l80 80c12.5 12.5 32.8 12.5 45.3 0l160-160zm96 128c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 402.7 86.6 297.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l128 128c12.5 12.5 32.8 12.5 45.3 0l256-256z"/></svg> `library(tidyverse)`

   * <svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M470.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L192 338.7 425.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"/></svg> `library(readr)`
   
   * <svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M470.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L192 338.7 425.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"/></svg> `library(dplyr)`
   
   * <svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M470.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L192 338.7 425.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"/></svg> `library(tidyr)`

* <svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M374.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 178.7l-57.4-57.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l80 80c12.5 12.5 32.8 12.5 45.3 0l160-160zm96 128c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 402.7 86.6 297.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l128 128c12.5 12.5 32.8 12.5 45.3 0l256-256z"/></svg> `library(readxl)`

* <svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M374.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 178.7l-57.4-57.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l80 80c12.5 12.5 32.8 12.5 45.3 0l160-160zm96 128c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 402.7 86.6 297.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l128 128c12.5 12.5 32.8 12.5 45.3 0l256-256z"/></svg> `library(openxlsx)`

* <svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M374.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 178.7l-57.4-57.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l80 80c12.5 12.5 32.8 12.5 45.3 0l160-160zm96 128c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 402.7 86.6 297.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l128 128c12.5 12.5 32.8 12.5 45.3 0l256-256z"/></svg> `library(lubridate)`

* <svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M374.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 178.7l-57.4-57.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l80 80c12.5 12.5 32.8 12.5 45.3 0l160-160zm96 128c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 402.7 86.6 297.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l128 128c12.5 12.5 32.8 12.5 45.3 0l256-256z"/></svg> `library(magrittr)`

* <svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M374.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 178.7l-57.4-57.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l80 80c12.5 12.5 32.8 12.5 45.3 0l160-160zm96 128c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 402.7 86.6 297.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l128 128c12.5 12.5 32.8 12.5 45.3 0l256-256z"/></svg> `library(datos)`



---

class: middle, center, inverse

<svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:3em;width:3em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M128 64c0-35.3 28.7-64 64-64H352V128c0 17.7 14.3 32 32 32H512V448c0 35.3-28.7 64-64 64H192c-35.3 0-64-28.7-64-64V336H302.1l-39 39c-9.4 9.4-9.4 24.6 0 33.9s24.6 9.4 33.9 0l80-80c9.4-9.4 9.4-24.6 0-33.9l-80-80c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l39 39H128V64zm0 224v48H24c-13.3 0-24-10.7-24-24s10.7-24 24-24H128zM512 128H384V0L512 128z"/></svg>
# Importar datos


---

## Importar archivos `.csv`

.pull-left[

.center[
&lt;img src="img/readr.png" width="150px"&gt;
]

`readr` lee datos rectangulares de archivos delimitados, como valores separados por comas (CSV) y valores separados por tabuladores (TSV).

`read_csv()` y `read_tsv()` son casos especiales del `read_delim()` más general. Son útiles para leer los tipos más comunes de datos de archivos sin formato, valores separados por comas y valores separados por tabulaciones, respectivamente.
]

.pull-right[

Para leer un archivo `.csv` en este caso utilizaremos la función `read_delim()` del paquete `readr` que es parte del `tidyverse`. 

Puedes cargar el paquete `tidyverse` o el paquete `readr`, en ambos casos te habilita la función `read_delim()`.

Para cargar nuestro archivo:


```r
library(readr)
ventas_2022 &lt;- read_delim("datos/sri_ventas_2022.csv", 
                          delim = "|")
```

También lo podemos hacer directamente desde la **barra de herramientas**, para esto, seguimos la siguiente ruta `File -&gt; Import Dataset -&gt; From Text (readr)`.

]

.footnote[ [readr.tidyverse.org](https://readr.tidyverse.org/) ]


---

## Importar desde Excel

.pull-left[

.center[
&lt;img src="img/readxl.png" width="150px"&gt;
]

`readxl` facilita la transferencia de datos de Excel a R y está diseñado para trabajar con datos tabulares. Admite tanto el formato `.xls` heredado como el formato `.xlsx` moderno basado en `xml`.

]

.pull-right[

Para leer un archivo de Excel la función a utilizar es `read_excel()` del paquete `readxl` que es parte del `tidyverse`. 

Para cargar nuestro archivo:


```r
library(readxl)
encuesta &lt;- read_excel("datos/encuesta.xlsx",
                       sheet = "enc1", skip = 2)
```

También lo podemos hacer directamente desde la **barra de herramientas**, para esto, seguimos la siguiente ruta `File -&gt; Import Dataset -&gt; From Excel...`.

]

&lt;br&gt;
&lt;br&gt;
&lt;br&gt;

.footnote[ [readxl.tidyverse.org](https://readxl.tidyverse.org/) ]

---

## Importar y exportar desde Excel

.pull-left[

.center[
&lt;img src="img/openxlsx.png" width="150px"&gt;
]

`openxlsx` simplifica la creación de archivos `.xlsx` al proporcionar una interfaz de alto nivel para escribir, diseñar y editar hojas de trabajo. Mediante el uso de Rcpp, los tiempos de lectura/escritura son comparables a los paquetes `xlsx` y `XLConnect` con el beneficio adicional de eliminar la dependencia de Java.

]

.pull-right[

Para leer un archivo de Excel con `openxlsx` la función a utilizar es `read_excel()` del paquete `readxl` que es parte del `tidyverse`. 

Para cargar nuestro archivo:


```r
library(openxlsx)
encuesta2 &lt;- read.xlsx("datos/encuesta.xlsx")
```

Para exportar nuestro archivo:


```r
write.xlsx(encuesta2, "datos/encuesta2.xlsx")
```

]

&lt;br&gt;
&lt;br&gt;

.footnote[ [openxlsx.rdocumentation.org](https://www.rdocumentation.org/packages/openxlsx/versions/4.2.5) || [ycphs.github.io/openxlsx](https://ycphs.github.io/openxlsx/index.html) ]


---


## Otros archivos

.pull-left[
### Importar 

- `library(haven)` del `tidyverse`
   - SPSS: `read_sav()`
   - SAS: `read_sas()`
   - STATA: `read_dta()`

- Desde la **barra de herramientas**, seguimos la siguiente ruta `File -&gt; Import Dataset -&gt; From Excel...`

- GoogleSpreadSheets con `googlesheets`

]

.pull-right[

- `data.table` para manejar grandes volúmenes de datos. Existe un curso corto gratuito brindado por la Sociedad Ecuatoriana de Estadística que pueden visitar en el siguiente link: [Sociedad_Ecuatoriana_Estadistica](https://www.youtube.com/watch?v=s1QnGTk0x8U&amp;list=PL2PpISw8vp_oJlVXpYYowclogCCLtEOfX).

&lt;br&gt;

### Exportar

- `library(haven)` del `tidyverse`
   - SPSS: `write_sav()`
   - SAS: `write_sas()`
   - STATA: `write_dta()`
   
]

&lt;br&gt;
&lt;br&gt;
&lt;br&gt;

.footnote[ [haven.tidyverse.org](https://haven.tidyverse.org/) ]

&lt;!--

# <svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M448.61 225.62c26.87.18 35.57-7.43 38.92-12.37 12.47-16.32-7.06-47.6-52.85-71.33 17.76-33.58 30.11-63.68 36.34-85.3 3.38-11.83 1.09-19 .45-20.25-1.72 10.52-15.85 48.46-48.2 100.05-25-11.22-56.52-20.1-93.77-23.8-8.94-16.94-34.88-63.86-60.48-88.93C252.18 7.14 238.7 1.07 228.18.22h-.05c-13.83-1.55-22.67 5.85-27.4 11-17.2 18.53-24.33 48.87-25 84.07-7.24-12.35-17.17-24.63-28.5-25.93h-.18c-20.66-3.48-38.39 29.22-36 81.29-38.36 1.38-71 5.75-93 11.23-9.9 2.45-16.22 7.27-17.76 9.72 1-.38 22.4-9.22 111.56-9.22 5.22 53 29.75 101.82 26 93.19-9.73 15.4-38.24 62.36-47.31 97.7-5.87 22.88-4.37 37.61.15 47.14 5.57 12.75 16.41 16.72 23.2 18.26 25 5.71 55.38-3.63 86.7-21.14-7.53 12.84-13.9 28.51-9.06 39.34 7.31 19.65 44.49 18.66 88.44-9.45 20.18 32.18 40.07 57.94 55.7 74.12a39.79 39.79 0 0 0 8.75 7.09c5.14 3.21 8.58 3.37 8.58 3.37-8.24-6.75-34-38-62.54-91.78 22.22-16 45.65-38.87 67.47-69.27 122.82 4.6 143.29-24.76 148-31.64 14.67-19.88 3.43-57.44-57.32-93.69zm-77.85 106.22c23.81-37.71 30.34-67.77 29.45-92.33 27.86 17.57 47.18 37.58 49.06 58.83 1.14 12.93-8.1 29.12-78.51 33.5zM216.9 387.69c9.76-6.23 19.53-13.12 29.2-20.49 6.68 13.33 13.6 26.1 20.6 38.19-40.6 21.86-68.84 12.76-49.8-17.7zm215-171.35c-10.29-5.34-21.16-10.34-32.38-15.05a722.459 722.459 0 0 0 22.74-36.9c39.06 24.1 45.9 53.18 9.64 51.95zM279.18 398c-5.51-11.35-11-23.5-16.5-36.44 43.25 1.27 62.42-18.73 63.28-20.41 0 .07-25 15.64-62.53 12.25a718.78 718.78 0 0 0 85.06-84q13.06-15.31 24.93-31.11c-.36-.29-1.54-3-16.51-12-51.7 60.27-102.34 98-132.75 115.92-20.59-11.18-40.84-31.78-55.71-61.49-20-39.92-30-82.39-31.57-116.07 12.3.91 25.27 2.17 38.85 3.88-22.29 36.8-14.39 63-13.47 64.23 0-.07-.95-29.17 20.14-59.57a695.23 695.23 0 0 0 44.67 152.84c.93-.38 1.84.88 18.67-8.25-26.33-74.47-33.76-138.17-34-173.43 20-12.42 48.18-19.8 81.63-17.81 44.57 2.67 86.36 15.25 116.32 30.71q-10.69 15.66-23.33 32.47C365.63 152 339.1 145.84 337.5 146c.11 0 25.9 14.07 41.52 47.22a717.63 717.63 0 0 0-115.34-31.71 646.608 646.608 0 0 0-39.39-6.05c-.07.45-1.81 1.85-2.16 20.33C300 190.28 358.78 215.68 389.36 233c.74 23.55-6.95 51.61-25.41 79.57-24.6 37.31-56.39 67.23-84.77 85.43zm27.4-287c-44.56-1.66-73.58 7.43-94.69 20.67 2-52.3 21.31-76.38 38.21-75.28C267 52.15 305 108.55 306.58 111zm-130.65 3.1c.48 12.11 1.59 24.62 3.21 37.28-14.55-.85-28.74-1.25-42.4-1.26-.08 3.24-.12-51 24.67-49.59h.09c5.76 1.09 10.63 6.88 14.43 13.57zm-28.06 162c20.76 39.7 43.3 60.57 65.25 72.31-46.79 24.76-77.53 20-84.92 4.51-.2-.21-11.13-15.3 19.67-76.81zm210.06 74.8"/></svg> Importar desde la web

.pull-left[

.center[
&lt;img src="img/rio.png" width="200px"&gt;
]

`rio` realiza importación y exportación optimizada de datos. Usa la extensión de archivo de un nombre de archivo para determinar qué tipo de archivo es. 

]

.pull-right[

En esta ocasión leeremos información disponible en la web del [Banco Central del Ecuador](https://www.bce.fin.ec/).


```r
library(rio)
# Data del Banco Central del Ecuador

# Para guardar la url de descarga en una variable
urlData &lt;- "https://contenido.bce.fin.ec/documentos/Estadisticas/SectorReal/CuentasProvinciales/Can2020.xlsm" 

# Para importar los datos de la url, escogemos la pestaña
# sheet: pestaña del documento
# skip: número de filas omitidas
# col_names: desea nombre de columnas sea la primera fila
dataBCE &lt;- import(urlData, sheet = "VAB Cantonal", skip = 6, col_names = TRUE)

```
]

.footnote[ [github.com/leeper/rio](https://github.com/leeper/rio) ]


# <svg aria-hidden="true" role="img" viewBox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M0 64C0 28.65 28.65 0 64 0H229.5C246.5 0 262.7 6.743 274.7 18.75L365.3 109.3C377.3 121.3 384 137.5 384 154.5V448C384 483.3 355.3 512 320 512H64C28.65 512 0 483.3 0 448V64zM336 448V160H256C238.3 160 224 145.7 224 128V48H64C55.16 48 48 55.16 48 64V448C48 456.8 55.16 464 64 464H320C328.8 464 336 456.8 336 448z"/></svg> Otros archivos

* **Excel:** Usando el paquete `openxlsx` con
`read.xlsx(xlsxFile , sheet , startRow , colNames , skipEmptyRows, rowNames)`

* `foreign` para cargar archivos de SAS, SPSS, Stata: SAS (`read.xport()`), SPSS (`read.spss()`), Stata (`read.dta()`).

* GIS sistemas de información geográfica con `rgal` y `raster`.

* `GoogleSpreadSheets` con googlesheets.



--&gt;


---

class: middle, center, inverse

<svg aria-hidden="true" role="img" viewBox="0 0 576 512" style="height:3em;width:3.38em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M128 160C128 142.3 142.3 128 160 128H288C305.7 128 320 142.3 320 160V256C320 273.7 305.7 288 288 288H160C142.3 288 128 273.7 128 256V160zM288 320C323.3 320 352 291.3 352 256V224H416C433.7 224 448 238.3 448 256V352C448 369.7 433.7 384 416 384H288C270.3 384 256 369.7 256 352V320H288zM48 115.8C38.18 106.1 32 94.22 32 80C32 53.49 53.49 32 80 32C94.22 32 106.1 38.18 115.8 48H460.2C469 38.18 481.8 32 496 32C522.5 32 544 53.49 544 80C544 94.22 537.8 106.1 528 115.8V396.2C537.8 405 544 417.8 544 432C544 458.5 522.5 480 496 480C481.8 480 469 473.8 460.2 464H115.8C106.1 473.8 94.22 480 80 480C53.49 480 32 458.5 32 432C32 417.8 38.18 405 48 396.2V115.8zM96 125.3V386.7C109.6 391.6 120.4 402.4 125.3 416H450.7C455.6 402.4 466.4 391.6 480 386.7V125.3C466.4 120.4 455.6 109.6 450.7 96H125.3C120.4 109.6 109.6 120.4 96 125.3z"/></svg>
# Estructuras de Datos


---

## Estructuras de datos - Objetos

Las estructuras de datos más usadas son:

- Vector
- Matriz
- Data.frame o Tibble
- Listas
- Series de tiempo
- Data.table


---

## Vectores

.pull-left[
El tipo de dato fundamental en R es el vector. Un vector es una secuencia de elementos de datos todos del mismo tipo.

Creamos un vector de dimensión 1:


```r
x &lt;- 4
is.vector(x)        #¿es vector?
## [1] TRUE
```

Hay varias formas de crear vectores, pero una de las más comunes es el operador de concatenación `c()`. 

A continuación creamos un vector de 4 elementos de tipo numérico:


```r
y &lt;- c(11, 13, 15, 20)
```
]

.pull-right[
Con la función `is.vector()` identificamos que el objeto corresponde a un vector:


```r
is.vector(y)
## [1] TRUE
y      # imprimir el contenido del objeto
## [1] 11 13 15 20
```

También podemos crear un vector de tipo caracter de 4 elementos:


```r
z &lt;- c("1", "5", "11", "14")
z
## [1] "1"  "5"  "11" "14"
is.vector(z)
## [1] TRUE
```
]

---

## Vectores

.pull-left[
También podemos realizar operaciones entre vectores de la misma dimensión:


```r
w &lt;- c(2, 5, 6, 8)
w
## [1] 2 5 6 8

y + 2*w - 3
## [1] 12 20 24 33
```

Para conocer la longitud de un vector usamos `length()`.


```r
length(y)
## [1] 4
```

]

.pull-right[

Podemos llamar elementos específicos de un vector usando la **indexación**. Por ejemplo:

* `x[]` es una forma de llamar a un elemento específico de un vector.
* `x[3]` es el tercer elemento.
* `x[-3]` es un vector con todo menos el tercer elemento.

Vamos a intentar indexar los vectores que tenemos:


```r
# extraigo el segundo elemento del vector w
w[2]    
## [1] 5

# imprimo el vector w, excepto su tercer elemento
w[-3]   
## [1] 2 5 8
```

]

---

## Data.frames

.pull-left[
Un data frame es un conjunto de vectores que deben cumplir las siguientes propiedades:

- Las componentes son **vectores**
- Cada vector puede ser de un **tipo de dato** distinto
- Cada columna es una **variable**
- Las columnas tienen la misma **longitud**

Las _filas_ se denominan **observaciones** y las _columnas_ se denominan **variables**.
]

.pull-right[
.center[
&lt;img src="img/dataframe.png" width="700px"&gt;
Artwork by @allison_horst
]
]

---

## Data.frames

.pull-left[
### Crear un data.frame

`data.frame()` crea data.frames a partir de la unión de vectores creados previamente.


```r
nombres &lt;- c("Marcela Cox", "Luis Vargas", "David Mieles")
edades &lt;- c(24,32,27)
seguro &lt;- factor(c("IESS", "BMI", "IESS"))

pacientes &lt;- data.frame(nombres, edades, seguro)
pacientes
##        nombres edades seguro
## 1  Marcela Cox     24   IESS
## 2  Luis Vargas     32    BMI
## 3 David Mieles     27   IESS
```

Ver objeto creado en el panel `Environment`.
]

.pull-right[
### Cambiar nombre de columnas

* Desde la creación del data.frame:


```r
pacientes2 &lt;- data.frame(N1=nombres, N2=edades, seguro)
pacientes2
##             N1 N2 seguro
## 1  Marcela Cox 24   IESS
## 2  Luis Vargas 32    BMI
## 3 David Mieles 27   IESS
```

* En un data.frame existente con `names()`:


```r
names(pacientes2) &lt;- c("Name", "Age", "Insurance")
pacientes2
##           Name Age Insurance
## 1  Marcela Cox  24      IESS
## 2  Luis Vargas  32       BMI
## 3 David Mieles  27      IESS
```
]

---

## Data.frames

.pull-left[
### Seleccionar elementos

Al igual que los vectores podemos seleccionar elementos de un data.frame con la ayuda de corchetes `[]`. Al usar una coma, puede indicar qué seleccionar de las filas y las columnas respectivamente. Por ejemplo, supongamos que queremos extraer la edad de David Mieles:

.center[
&lt;img src="img/dataframe2.png" width="750px"&gt;
]

]

.pull-right[
La edad de David Mieles se ubica en la fila 3 y la columna 2:


```r
pacientes[3,2]
## [1] 27
```

### Otros usos

- `nombre_dataframe[1,2]` selecciona el valor en la primera fila y la segunda columna en `nombre_dataframe`.

- `nombre_dataframe[1:3,2:4]` selecciona las filas 1, 2, 3 y las columnas 2, 3, 4 en `nombre_dataframe`.

- A veces desea seleccionar todos los elementos de una fila o columna. Por ejemplo, `nombre_dataframe[1, ]` selecciona todos los elementos de la primera fila.

]

---

## Data.frames

.pull-left[
### Seleccionar columnas

También podemos consultar a R por los valores de una columna entera de nuestro data set con el símbolo `$`.


```r
pacientes$nombres
## [1] "Marcela Cox"  "Luis Vargas"  "David Mieles"
```

Y aplicar una función a esa columna:


```r
mean(pacientes$edades)
## [1] 27.66667
```
]

.pull-right[
### Ordenando elementos

En el análisis de datos, puede ordenar sus datos de acuerdo con una determinada variable en el conjunto de datos. `order()` es una función que le da la posición clasificada de cada elemento cuando se aplica a una variable, como un vector, por ejemplo:


```r
## podemos ordenar los elementos de vectores
order(pacientes$edades)
## [1] 1 3 2

## podemos ordenar los elementos de la columna de un data.frame
pacientes[order(edades),]
##        nombres edades seguro
## 1  Marcela Cox     24   IESS
## 3 David Mieles     27   IESS
## 2  Luis Vargas     32    BMI
```

]

---

## Funciones básicas para explorar data.frames

.pull-left[
* **`str():`** muestra de forma compacta la estructura interna de un objeto R.

* **`colnames():`** muestra el nombre de las variables de un data.frame.

* **`head():`** muestra las 10 primeras obervaciones del conjunto de datos.

* **`tail():`** muestra las 4 últimas observaciones del conjunto de datos.
]

.pull-right[
* **`summary():`** produce resúmenes de resultados de varias variables. Los resultados dependen de la clase de datos.

* **`sum():`** devuelve la suma de todos los valores presentes en sus argumentos.

* **`min():`** devuelve el valor mínimo de un vector numérico.

* **`max():`** devuelve el valor máximo de un vector numérico.
]

---

background-color: var(--azul-claro)
class: middle, center, inverse

<svg aria-hidden="true" role="img" viewBox="0 0 640 512" style="height:3em;width:3.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M64 96c0-35.3 28.7-64 64-64H512c35.3 0 64 28.7 64 64V352H512V96H128V352H64V96zM0 403.2C0 392.6 8.6 384 19.2 384H620.8c10.6 0 19.2 8.6 19.2 19.2c0 42.4-34.4 76.8-76.8 76.8H76.8C34.4 480 0 445.6 0 403.2zM281 209l-31 31 31 31c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-48-48c-9.4-9.4-9.4-24.6 0-33.9l48-48c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9zM393 175l48 48c9.4 9.4 9.4 24.6 0 33.9l-48 48c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l31-31-31-31c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0z"/></svg>
## PRÁCTICA 2.1

---

## <svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M362.7 19.3L314.3 67.7 444.3 197.7l48.4-48.4c25-25 25-65.5 0-90.5L453.3 19.3c-25-25-65.5-25-90.5 0zm-71 71L58.6 323.5c-10.4 10.4-18 23.3-22.2 37.4L1 481.2C-1.5 489.7 .8 498.8 7 505s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L421.7 220.3 291.7 90.3z"/></svg> Práctica 2.1

1. Revise la estructura del conjunto de datos `ventas_2022`. Asegúrese que el objeto haya sido cargado previamente en Environment. Convierta el objeto a un data.frame y cámbiele el nombre a `ventas`.




2. Revise los nombres de las variables del conjunto de datos `ventas`.

3. Visualice las primeras 10 observaciones.

4. Visualice las 8 últimas observaciones.

5. Efectúe un resumen de estadísticas básicas.

6. Extraiga las 100 primeras observaciones que muestre las columnas de la provincia, cantón y las ventas.

7. Extraiga toda la columna del total de ventas.

8. Extraiga toda la información de la observación 55.


---

class: middle, center, inverse

<svg aria-hidden="true" role="img" viewBox="0 0 576 512" style="height:3em;width:3.38em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M512 64H64C28.65 64 0 92.65 0 128v256c0 35.35 28.65 64 64 64h448c35.35 0 64-28.65 64-64V128C576 92.65 547.3 64 512 64zM528 384c0 8.822-7.178 16-16 16H64c-8.822 0-16-7.178-16-16V128c0-8.822 7.178-16 16-16h448c8.822 0 16 7.178 16 16V384zM140 152h-24c-6.656 0-12 5.344-12 12v24c0 6.656 5.344 12 12 12h24c6.656 0 12-5.344 12-12v-24C152 157.3 146.7 152 140 152zM196 200h24c6.656 0 12-5.344 12-12v-24c0-6.656-5.344-12-12-12h-24c-6.656 0-12 5.344-12 12v24C184 194.7 189.3 200 196 200zM276 200h24c6.656 0 12-5.344 12-12v-24c0-6.656-5.344-12-12-12h-24c-6.656 0-12 5.344-12 12v24C264 194.7 269.3 200 276 200zM356 200h24c6.656 0 12-5.344 12-12v-24c0-6.656-5.344-12-12-12h-24c-6.656 0-12 5.344-12 12v24C344 194.7 349.3 200 356 200zM460 152h-24c-6.656 0-12 5.344-12 12v24c0 6.656 5.344 12 12 12h24c6.656 0 12-5.344 12-12v-24C472 157.3 466.7 152 460 152zM140 232h-24c-6.656 0-12 5.344-12 12v24c0 6.656 5.344 12 12 12h24c6.656 0 12-5.344 12-12v-24C152 237.3 146.7 232 140 232zM196 280h24c6.656 0 12-5.344 12-12v-24c0-6.656-5.344-12-12-12h-24c-6.656 0-12 5.344-12 12v24C184 274.7 189.3 280 196 280zM276 280h24c6.656 0 12-5.344 12-12v-24c0-6.656-5.344-12-12-12h-24c-6.656 0-12 5.344-12 12v24C264 274.7 269.3 280 276 280zM356 280h24c6.656 0 12-5.344 12-12v-24c0-6.656-5.344-12-12-12h-24c-6.656 0-12 5.344-12 12v24C344 274.7 349.3 280 356 280zM460 232h-24c-6.656 0-12 5.344-12 12v24c0 6.656 5.344 12 12 12h24c6.656 0 12-5.344 12-12v-24C472 237.3 466.7 232 460 232zM400 320h-224C167.1 320 160 327.1 160 336V352c0 8.875 7.125 16 16 16h224c8.875 0 16-7.125 16-16v-16C416 327.1 408.9 320 400 320z"/></svg>
# Tipos de Datos

---

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="img/tiposdatos.png" alt="Figura 2. Tipos de datos en R" width="100%" /&gt;
&lt;p class="caption"&gt;Figura 2. Tipos de datos en R&lt;/p&gt;
&lt;/div&gt;

---

## Datos Numéricos

.pull-left[
Para determinar el tipo de dato de un data set aplicamos la función `class()`.


```r
# clase de un vector de 1 elemento
class(5)
## [1] "numeric"

# clase de la columna edades del dataset pacientes
class(pacientes$edades)
## [1] "numeric"
```

Ahora, el vector `\(z\)` de tipo caracter lo convertiremos en tipo numérico.


```r
z
## [1] "1"  "5"  "11" "14"
class(z)
## [1] "character"
```
]

.pull-right[
### Con `as.numeric()`.


```r
# cambio de clase caracter a numérico con as.numeric()
class(as.numeric(z))
## [1] "numeric"
```

### Con `parse_number()`.


```r
library(readr)
# cambio de clase caracter a numérico con parse_number()
class(parse_number(z))
## [1] "numeric"
```

]

---

## Datos Numéricos

.pull-left[
**`parse_number()`** es muy útil para resolver problemas de decimales, caracteres que acompañan a números y caracteres de agrupación.

En R, por default, el decimal es el punto. A continuación, tiene dos argumentos que le pueden servir de ayuda:

- `grouping_mark` para especificar el signo de agrupación; 
- `decimal_mark` para especificar el decimal a cambiar.


```r
parse_number("6'789,56", 
             locale = locale(grouping_mark = "'",
                             decimal_mark = ","))
## [1] 6789.56
```

]

.pull-right[
También sirve para extraer números insertos en texto.


```r
parse_number("$100")
## [1] 100

parse_number("20%")
## [1] 20

parse_number("It cost $123.45")
## [1] 123.45

parse_number("$123.456.789", 
             locale = locale(grouping_mark = "."))
## [1] 123456789
```

]

---

&lt;!--

## Cadena de Caracteres

.pull-left[
`readr` asume que tus datos están codificados en UTF-8. 

`charToRaw():` realiza una representación subyacente de una cadena de texto.


```r
charToRaw("Linda")
## [1] 4c 69 6e 64 61
```

¿Qué sucede cuando tus datos producidos no entienden UTF-8? 


```r
library(readr)
x1 &lt;- "El Ni\xf1o was particularly bad this year"
```

]

.pull-right[

Para corregir el problema necesitas especificar la codificación en **`parse_character()`**:


```r
parse_character(x1, locale = locale(encoding = "Latin1"))
## [1] "El Niño was particularly bad this year"
```

¿Cómo encontrar la codificación correcta? Con `guess_encoding()`


```r
guess_encoding(charToRaw(x1))
## # A tibble: 2 × 2
##   encoding   confidence
##   &lt;chr&gt;           &lt;dbl&gt;
## 1 ISO-8859-1       0.46
## 2 ISO-8859-9       0.23
```

]

.footnote[ [Tablas de codificación de caracteres](http://www.atc.uniovi.es/tablas.php)]


## Cadena de Caracteres

.pull-left[

.center[
&lt;img src="img/stringr.png" width="200px"&gt;
]

`stringr` proporciona un conjunto cohesivo de funciones diseñadas para trabajar de forma más fácil con cadenas de caracteres.


```r
library(stringr)
```

]

.pull-right[


```r
frase &lt;- "Esta es una cadena de caracteres"
class(frase)
## [1] "character"
```

`str_length()` indica el número de caracteres de una cadena.


```r
str_length(frase)
## [1] 32
```

`str_c()` combina dos o más cadenas:


```r
str_c(frase, " y esto también")
## [1] "Esta es una cadena de caracteres y esto también"
```

]

--&gt;

## Cadena de Caracteres

.pull-left[
Para convertir datos a tipo caracter usamos la función `as.character()`:


```r
pacientes
##        nombres edades seguro
## 1  Marcela Cox     24   IESS
## 2  Luis Vargas     32    BMI
## 3 David Mieles     27   IESS

class(pacientes$seguro)
## [1] "factor"

## convertir de factor a tipo caracter
pacientes$seguro &lt;- as.character(pacientes$seguro)
class(pacientes$seguro)
## [1] "character"
```
]

.pull-right[
Convertimos un dato tipo fecha a tipo caracter:


```r
## consultamos la función now() y su clase
lubridate::now()
## [1] "2022-11-17 14:32:59 -05"

class(lubridate::now())
## [1] "POSIXct" "POSIXt"

## convertimos a tipo caracter
as.character(lubridate::now())
## [1] "2022-11-17 14:32:59"

class(as.character(lubridate::now()))
## [1] "character"
```
]

&lt;br&gt;
&lt;br&gt;

.footnote[ [stringr.tidyverse.org](https://stringr.tidyverse.org/) || [tidyverse/reprex](https://github.com/tidyverse/reprex)]

---

## Factores

&lt;!--

.pull-left[
.center[
&lt;img src="img/forcats.png" width="200px"&gt;
]

`forcats` proporciona un conjunto de herramientas que resuelven problemas comunes con factores.


```r
library(forcats)
```

]

--&gt;

.pull-left[
Imaginemos que tenemos la siguiente variable que registra meses:


```r
fc1 &lt;- c("Dic", "Abr", "Ene", "Mar")
class(fc1)
## [1] "character"
```

Si trabajamos esta variable en tipo caracter, tendremos 2 problemas:
1. Errores de tipeo,
2. No se ordena de una forma útil.

Estos problemas se solucionan trabajando con factores.
]

.pull-right[
Para crear un factor con **`factor()`** debes:

1. Definir una lista de niveles válidos.


```r
niveles_meses &lt;- c("Ene", "Feb", "Mar", "Abr", "May", "Jun", "Jul", "Ago", "Sep", "Oct", "Nov", "Dic")
```

2. Ahorar puedes crear un factor.


```r
y1 &lt;- factor(fc1, levels = niveles_meses)
class(y1)
## [1] "factor"

# para acceder a los niveles del factor
levels(y1)
##  [1] "Ene" "Feb" "Mar" "Abr" "May" "Jun" "Jul" "Ago" "Sep" "Oct" "Nov" "Dic"
```
]

&lt;br&gt;

.footnote[ [forcats.tidyverse.org](https://forcats.tidyverse.org/) || [Wrangling categorical data in R](https://peerj.com/preprints/3163/) || [stringsAsFactors = &lt;sigh&gt;](https://notstatschat.tumblr.com/post/124987394001/stringsasfactors-sigh) ]

---

## Fechas y Horas

.pull-left[

**`parse_datetime()`** asume una fecha-hora ISO8601, estándar internacional en el que los componentes de una fecha están organizados de mayor a menor: año, mes, día, hora, minuto, segundo.


```r
# Dato de fecha-hora
fecha1 &lt;- "2010-10-01T2010"
parse_datetime(fecha1)
## [1] "2010-10-01 20:10:00 UTC"

# Si se omite la hora, será determinada como medianoche.
fecha2 &lt;- "20101010"
parse_datetime(fecha2)
## [1] "2010-10-10 UTC"
```

]

.pull-right[

**`parse_date()`** asume aaaa-mm-dd o aaaa/mm/dd.


```r
fecha3 &lt;- "2010-10-01"
parse_date(fecha3)
## [1] "2010-10-01"
```

**`parse_time()`** espera la hh:mm:ss, los segundos y el especificador am/pm son opcionales.


```r
library(hms)
parse_time("01:10 am")
## 01:10:00
parse_time("20:10:01")
## 20:10:01
```
]

&lt;br&gt;
&lt;br&gt;

.footnote[ [ISO 8601](https://en.wikipedia.org/wiki/ISO_8601) || [hms.tidyverse.org](https://hms.tidyverse.org/)]

---

## Fechas y Horas

.pull-left[
.center[
&lt;img src="img/lubridate.png" width="200px"&gt;
]

`lubridate` hace que sea más fácil hacer las cosas que hace R con fecha y hora y hace posible hacer las cosas que R base no hace.


```r
library(lubridate)
```

]

.pull-right[
Hay tres tipos de datos de fechas/horas que se refieren a un instante en el tiempo:

* Una fecha o `date`.
* Una hora o `time` dentro de un día.
* Una fecha-hora o date-time `dttm` (llamado también `POSIXct`).

Para obtener la fecha o fecha-hora actual utiliza `today()` o `now()`:


```r
today()
## [1] "2022-11-17"
now()
## [1] "2022-11-17 14:33:00 -05"
```
]

&lt;br&gt;

.footnote[ [lubridate.tidyverse.org](https://lubridate.tidyverse.org/) || [hms.tidyverse.org](https://hms.tidyverse.org/) ]

---

## Fechas y Horas

.pull-left[

Hay tres modos en los que puedes crear una fecha/hora:

* Desde una cadena de caracteres (o string, en inglés).
* Desde componentes de fecha-hora individuales.
* Desde un objeto fecha-hora existente.

### Desde cadenas de caracteres


```r
ymd("2017-01-31")
## [1] "2017-01-31"
ymd("20170131")
## [1] "2017-01-31"
```
]


.pull-right[


```r
mdy("01-31-2017")
## [1] "2017-01-31"
mdy("01312017")
## [1] "2017-01-31"

dmy("31-01-2017")
## [1] "2017-01-31"
dmy("31012017")
## [1] "2017-01-31"

mdy_hm("01/31/2017 08:01")
## [1] "2017-01-31 08:01:00 UTC"
ymd_hms("2017-01-31 20:11:59")
## [1] "2017-01-31 20:11:59 UTC"
```

]

---

## Fechas y Horas

.pull-left[
### Desde componentes individuales

Crearé un data.frame donde las fechas y las horas están repartidos en diferentes columnas.


```r
ejemplo &lt;- data.frame(anio= c(1994, 1992, 1987),
                      dia= c(21, 02, 15),
                      mes= c(02, 04, 05),
                      hora= c(20, 14, 09),
                      minuto= c(45, 30, 15))
ejemplo
##   anio dia mes hora minuto
## 1 1994  21   2   20     45
## 2 1992   2   4   14     30
## 3 1987  15   5    9     15
```

]

.pull-right[
`make_date()` para crear fecha.


```r
# forma fecha que contiene dia, mes y anio
make_date(ejemplo$anio, ejemplo$mes, ejemplo$dia)
## [1] "1994-02-21" "1992-04-02" "1987-05-15"
```

`make_datetime()` para crear fecha-hora.


```r
# forma fecha-hora
make_datetime(ejemplo$anio, ejemplo$mes, ejemplo$dia, ejemplo$hora, ejemplo$minuto)
## [1] "1994-02-21 20:45:00 UTC" "1992-04-02 14:30:00 UTC"
## [3] "1987-05-15 09:15:00 UTC"
```

### Desde otros tipos


```r
as_datetime(today())
as_date(now())
```
]


---

background-color: var(--azul-claro)
class: middle, center, inverse

<svg aria-hidden="true" role="img" viewBox="0 0 640 512" style="height:3em;width:3.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M64 96c0-35.3 28.7-64 64-64H512c35.3 0 64 28.7 64 64V352H512V96H128V352H64V96zM0 403.2C0 392.6 8.6 384 19.2 384H620.8c10.6 0 19.2 8.6 19.2 19.2c0 42.4-34.4 76.8-76.8 76.8H76.8C34.4 480 0 445.6 0 403.2zM281 209l-31 31 31 31c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-48-48c-9.4-9.4-9.4-24.6 0-33.9l48-48c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9zM393 175l48 48c9.4 9.4 9.4 24.6 0 33.9l-48 48c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l31-31-31-31c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0z"/></svg>
## PRÁCTICA 2.2

---

## <svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M362.7 19.3L314.3 67.7 444.3 197.7l48.4-48.4c25-25 25-65.5 0-90.5L453.3 19.3c-25-25-65.5-25-90.5 0zm-71 71L58.6 323.5c-10.4 10.4-18 23.3-22.2 37.4L1 481.2C-1.5 489.7 .8 498.8 7 505s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L421.7 220.3 291.7 90.3z"/></svg> Práctica 2.2

1. Modificar el tipo de dato de las variables _"VENTAS_NETAS_TARIFA_12", "VENTAS_NETAS_TARIFA_0", "EXPORTACIONES", "COMPRAS_ENTAS_TARIFA_12", "COMPRAS_NETAS_TARIFA_0", "IMPORTACIONES", "COMPRAS_RISE"_.




2. Crear una nueva columna con la función `dplyr::mutate()` que indique la fecha en el formato (YYYY-MM-DD).




3. Convertir los meses en un vector tipo factor y modificar los niveles al nombre abreviado de cada mes.




---

class: middle, center, inverse

<svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:3em;width:2.62em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M448 80v48c0 44.2-100.3 80-224 80S0 172.2 0 128V80C0 35.8 100.3 0 224 0S448 35.8 448 80zM393.2 214.7c20.8-7.4 39.9-16.9 54.8-28.6V288c0 44.2-100.3 80-224 80S0 332.2 0 288V186.1c14.9 11.8 34 21.2 54.8 28.6C99.7 230.7 159.5 240 224 240s124.3-9.3 169.2-25.3zM0 346.1c14.9 11.8 34 21.2 54.8 28.6C99.7 390.7 159.5 400 224 400s124.3-9.3 169.2-25.3c20.8-7.4 39.9-16.9 54.8-28.6V432c0 44.2-100.3 80-224 80S0 476.2 0 432V346.1z"/></svg>
# Datos Relacionales con `dplyr`

---

## Operador `pipe` `%&gt;%`

.pull-left[

.center[
&lt;img src="img/magrittr.png" width="200px"&gt;
]

`magrittr` ofrece un conjunto de operadores que hacen que su código sea más legible.


```r
library(magrittr)
```

]


.pull-right[

* Estructura secuencias de operaciones de datos de izquierda a derecha (a diferencia de desde adentro hacia afuera).

* Minimiza la necesidad de variables locales y definiciones de funciones, y

* Facilita la adición de pasos en cualquier lugar de la secuencia de operaciones.

Puede utilizar el atajo de teclado `Ctrl+Shift+M` para generar el operador `%&gt;%`.


```r
dataset %&gt;% 
    funcion1() %&gt;% 
    funcion2() %&gt;%
    funcion3()
```

]

&lt;br&gt;

.footnote[ [magrittr.tidyverse.org](https://magrittr.tidyverse.org/) ]


---

.center[
![](https://erikgahner.dk/img/2022/R_pipe.gif)
]

---

## Datos relacionales con `dplyr`

.pull-left[La mayor parte del tiempo, nos vienen muchas tablas de información que debemos combinar para responder a nuestras preguntas de interés, a esto se le llama **datos relacionales**.

Para trabajar con datos relacionales necesitas verbos que funcionen con pares de tablas y para esto existen tres familias de verbos diseñadas para trabajar con datos relacionales que son las 1) **uniones de transformación** (_mutating joins_), 2) **uniones de filtro** (_filtering joins_) y 3) **operaciones de conjuntos** (_set operations_).

El lugar más común para encontrar datos relacionales es en un **sistema relacional de administración de bases de datos** (_Relational Data Base Management System_ en inglés), un concepto que abarca casi todas las bases de datos modernas. 
]

.pull-right[Una de las formas de mostrar las relaciones entre las diferentes tablas es mediante un diagrama:

&lt;img src="img/diagrama.png" width="100%" style="display: block; margin: auto;" /&gt;

]

---

## Mutating joins

Las **uniones de transformación** (del inglés _mutating joins_) agregan nuevas variables a un data frame a partir de las observaciones coincidentes en otra tabla.

En las uniones de transformación tenemos algunos tipos de uniones:


&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="img/mutating.png" alt="Figura 3. Tipos de mutating joins" width="100%" /&gt;
&lt;p class="caption"&gt;Figura 3. Tipos de mutating joins&lt;/p&gt;
&lt;/div&gt;

---

## Mutating joins

Para entender el `inner_join`, `left_join()`, `right_join()` y `full_join()`, vamos a crear los siguientes data frames:

.pull-left[

```r
df_1 &lt;- data.frame(Nombre= c('Belén', 'Noé', 'Salvador', 'Anne', 'Pablo', 'Rafaela', 'Victoria'),
                   Edad = c(22,18,21,26,25,23,21),
                   Ciudad= factor(c('Gye', 'Uio', 'Cue', 'Gye', 'Cue', 'Uio', 'Cue')) )

df_1
##     Nombre Edad Ciudad
## 1    Belén   22    Gye
## 2      Noé   18    Uio
## 3 Salvador   21    Cue
## 4     Anne   26    Gye
## 5    Pablo   25    Cue
## 6  Rafaela   23    Uio
## 7 Victoria   21    Cue
```
]

.pull-right[

```r
df_2 &lt;- data.frame(
    A= c('Ana', 'Belén','Jose', 'Anne', 'Luis'), 
    B= c(100,200,300,200,250),
    C= c('Soltera','Soltera','Casado','Divorciada','Soltero'))

df_2
##       A   B          C
## 1   Ana 100    Soltera
## 2 Belén 200    Soltera
## 3  Jose 300     Casado
## 4  Anne 200 Divorciada
## 5  Luis 250    Soltero
```

]

---

## Mutating joins

.pull-left[
### `inner_join()`

Muestra las observaciones cuyas claves coinciden en ambos conjuntos de datos:


```r
df_1 %&gt;% inner_join(df_2, 
                    by = c("Nombre"="A"))
##   Nombre Edad Ciudad   B          C
## 1  Belén   22    Gye 200    Soltera
## 2   Anne   26    Gye 200 Divorciada
```
]

.pull-right[
### `left_join()`

Muestra las observaciones del conjunto de la izquierda pero añade los datos del conjunto de la derecha, coincidan o no coincidan. Si no coinciden, se agregan con NA.


```r
df_1 %&gt;% left_join(df_2, 
                   by = c("Nombre"="A"))
##     Nombre Edad Ciudad   B          C
## 1    Belén   22    Gye 200    Soltera
## 2      Noé   18    Uio  NA       &lt;NA&gt;
## 3 Salvador   21    Cue  NA       &lt;NA&gt;
## 4     Anne   26    Gye 200 Divorciada
## 5    Pablo   25    Cue  NA       &lt;NA&gt;
## 6  Rafaela   23    Uio  NA       &lt;NA&gt;
## 7 Victoria   21    Cue  NA       &lt;NA&gt;
```
]

---

## Mutating joins

.pull-left[
### `right_join()`

Muestra las observaciones del conjunto de la derecha pero añade los datos del conjunto de la izquierda, coincidan o no coincidan. Si no coinciden, se agregan con NA.


```r
df_1 %&gt;% right_join(df_2, 
                    by = c("Nombre"="A"))
##   Nombre Edad Ciudad   B          C
## 1  Belén   22    Gye 200    Soltera
## 2   Anne   26    Gye 200 Divorciada
## 3    Ana   NA   &lt;NA&gt; 100    Soltera
## 4   Jose   NA   &lt;NA&gt; 300     Casado
## 5   Luis   NA   &lt;NA&gt; 250    Soltero
```

]

.pull-right[
### `full_join()`

Muestra las observaciones de ambos conjuntos de datos, cuando los datos no coinciden, se agregan con NA.


```r
df_1 %&gt;% full_join(df_2, 
                   by = c("Nombre"="A"))
##      Nombre Edad Ciudad   B          C
## 1     Belén   22    Gye 200    Soltera
## 2       Noé   18    Uio  NA       &lt;NA&gt;
## 3  Salvador   21    Cue  NA       &lt;NA&gt;
## 4      Anne   26    Gye 200 Divorciada
## 5     Pablo   25    Cue  NA       &lt;NA&gt;
## 6   Rafaela   23    Uio  NA       &lt;NA&gt;
## 7  Victoria   21    Cue  NA       &lt;NA&gt;
## 8       Ana   NA   &lt;NA&gt; 100    Soltera
## 9      Jose   NA   &lt;NA&gt; 300     Casado
## 10     Luis   NA   &lt;NA&gt; 250    Soltero
```
]

---

## Filtering joins

Las **uniones de filtro** (del inglés _filtering joins_) filtran observaciones en un data frame con base en si coinciden o no con una observación de otra tabla.

.pull-left[
### `semi_join()`

Muestra las observaciones del conjunto de la izquierda que tiene coincidencias con el conjunto de la derecha:


```r
df_1 %&gt;% semi_join(df_2, 
                   by = c("Nombre"="A"))
##   Nombre Edad Ciudad
## 1  Belén   22    Gye
## 2   Anne   26    Gye
```
]

.pull-right[
### `anti_join()`

Muestra las observaciones del conjunto de la izquierda que no tiene coincidencias con el conjunto de la derecha:


```r
df_1 %&gt;% anti_join(df_2, 
                   by = c("Nombre"="A"))
##     Nombre Edad Ciudad
## 1      Noé   18    Uio
## 2 Salvador   21    Cue
## 3    Pablo   25    Cue
## 4  Rafaela   23    Uio
## 5 Victoria   21    Cue
```
]

---

## Set operations

Las **operaciones de conjuntos** (del inglés _set operations_) tratan las observaciones como elementos de un conjunto. Las comparaciones se realizan entre conjuntos que contengan las mismas columnas, pues se revisa cómo difieren las observaciones entre los conjuntos, para esto, revisaremos las funciones `intersect()`, `union()` y `setdiff()`. Para ejemplificar esta parte crearemos el data.frame `df3`.

.pull-left[


```r
df_3 &lt;- data.frame(Nombre= c('Belén', 'Noé', 'María', 'Anne', 'Pablo'),
                   Edad = c(22,18,21,26,25),
                   Ciudad= factor(c('Cue', 'Uio', 'Cue', 'Gye', 'Cue')))

df_3
##   Nombre Edad Ciudad
## 1  Belén   22    Cue
## 2    Noé   18    Uio
## 3  María   21    Cue
## 4   Anne   26    Gye
## 5  Pablo   25    Cue
```

]

.pull-right[
### `intersect()`

Devuelve las observaciones comunes entre ambos conjuntos.


```r
intersect(df_1, df_3)
##   Nombre Edad Ciudad
## 1    Noé   18    Uio
## 2   Anne   26    Gye
## 3  Pablo   25    Cue
```

]

---

## Set operations

.pull-left[
### `union()` 

Devuelve las observaciones únicas en ambos conjuntos, es decir que no see repiten en ningun de los dos conjuntos.


```r
union(df_1, df_3)
##     Nombre Edad Ciudad
## 1    Belén   22    Gye
## 2      Noé   18    Uio
## 3 Salvador   21    Cue
## 4     Anne   26    Gye
## 5    Pablo   25    Cue
## 6  Rafaela   23    Uio
## 7 Victoria   21    Cue
## 8    Belén   22    Cue
## 9    María   21    Cue
```
]

.pull-right[
### `setdiff()` 

Devuelve las observaciones en el primer conjunto pero que son diferentes del segundo conjunto.


```r
setdiff(df_1, df_3)
##     Nombre Edad Ciudad
## 1    Belén   22    Gye
## 2 Salvador   21    Cue
## 3  Rafaela   23    Uio
## 4 Victoria   21    Cue
```
]

---

background-color: var(--azul-claro)
class: middle, center, inverse

<svg aria-hidden="true" role="img" viewBox="0 0 640 512" style="height:3em;width:3.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M64 96c0-35.3 28.7-64 64-64H512c35.3 0 64 28.7 64 64V352H512V96H128V352H64V96zM0 403.2C0 392.6 8.6 384 19.2 384H620.8c10.6 0 19.2 8.6 19.2 19.2c0 42.4-34.4 76.8-76.8 76.8H76.8C34.4 480 0 445.6 0 403.2zM281 209l-31 31 31 31c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-48-48c-9.4-9.4-9.4-24.6 0-33.9l48-48c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9zM393 175l48 48c9.4 9.4 9.4 24.6 0 33.9l-48 48c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l31-31-31-31c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0z"/></svg>
## PRÁCTICA 2.3

---

## <svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M362.7 19.3L314.3 67.7 444.3 197.7l48.4-48.4c25-25 25-65.5 0-90.5L453.3 19.3c-25-25-65.5-25-90.5 0zm-71 71L58.6 323.5c-10.4 10.4-18 23.3-22.2 37.4L1 481.2C-1.5 489.7 .8 498.8 7 505s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L421.7 220.3 291.7 90.3z"/></svg> Práctica 2.3

1. Cargue a R, la hoja `ciiu_1level` del archivo denominado `CIIU.xls`. _CIIU_ es la Clasificación Nacional de Actividades Económicas.




2. ¿Qué join necesitamos realizar en nuestros datos `ventas` para que aparezca el nombre del tipo de actividad? Efectúelo.




---

class: middle, center, inverse

<svg aria-hidden="true" role="img" viewBox="0 0 640 512" style="height:3em;width:3.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M627.6 57.3c14-10.9 16.5-31 5.6-44.9s-31-16.5-44.9-5.6l-144 112-72 56-8.7 6.8-30.8-39.4c-3.7-4.8-9.8-7-15.8-5.8s-10.7 5.7-12.3 11.5l-12.5 46.3L371.1 295l48-.9c6.1-.1 11.5-3.7 14.1-9.1s1.9-11.9-1.8-16.7L403 231.9l8.6-6.7 72-56 144-112zM16.7 507.7c37.4 2.8 196.8 12 252.3-31.4c57.7-45.1 76.8-161.5 76.8-161.5L267.1 213.9s-117.6-9.6-175.3 35.5C69 267.1 50.5 304.1 36.3 344c-2.4 6.7 4.7 12.8 11 9.4L86.2 333c4.1-2.2 9.2-1.1 12 2.6s2.7 8.8-.4 12.3L24.4 430.4C13.2 442.9 5.5 458.1 2.4 474.5c-.9 4.8-1.6 8.9-2.2 12.1c-.9 5 .5 10.1 3.6 14.1s7.7 6.6 12.8 7z"/></svg>
# Datos ordenados con `tidyr`

---

## Datos ordenados

Existen tres reglas interrelacionadas que hacen que un conjunto de datos sea ordenado:

* Cada variable debe tener su propia columna.
* Cada observación debe tener su propia fila.
* Cada valor debe tener su propia celda.

&lt;br&gt;

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="img/tidy_data.png" alt="Figura 4: Reglas que hacen que un conjunto de datos sea ordenado" width="1000" /&gt;
&lt;p class="caption"&gt;Figura 4: Reglas que hacen que un conjunto de datos sea ordenado&lt;/p&gt;
&lt;/div&gt;

---

##  Funciones del paquete `tidyr`

&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;


| Función        |  Acción                                    |
|:---------------|-------------------------------------------:|
| `pivot_longer()`     | *Modifica el nombre de las variables* |
| `pivot_wider()`     | *Selecciona o descarta variables (columnas) de un conjunto de datos* |

&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;

.footnote[ [tidyr.tidyverse.org](https://tidyr.tidyverse.org/) ]

---

## Ordenar datos a lo largo

&lt;br&gt;

.pull-left[
.center[
&lt;img src="img/longer.png" width="600px"&gt;
]
]

.pull-right[
**`pivot_longer()`** alarga datos al contraer varias columnas en dos. Los nombres de columna se mueven a una nueva columna de `names_to` y los valores a una nueva columna de `values_to`.


```r
pivot_longer(data, cols, 
             names_to = "name", 
             values_to = "value", 
             values_drop_na = FALSE)
```
]

---

## Ordenar datos a lo largo

.pull-left[

```r
library(datos)
## 
## Attaching package: 'datos'
## The following object is masked _by_ '.GlobalEnv':
## 
##     nombres

table4a
## # A tibble: 3 × 3
##   country     `1999` `2000`
## * &lt;chr&gt;        &lt;int&gt;  &lt;int&gt;
## 1 Afghanistan    745   2666
## 2 Brazil       37737  80488
## 3 China       212258 213766
```
]

.pull-right[

```r
tabla4a %&gt;%  pivot_longer(cols = c(`1999`, `2000`), 
               names_to = "anio", 
               values_to = "casos")
## # A tibble: 6 × 3
##   pais       anio   casos
##   &lt;chr&gt;      &lt;chr&gt;  &lt;int&gt;
## 1 Afganistán 1999     745
## 2 Afganistán 2000    2666
## 3 Brasil     1999   37737
## 4 Brasil     2000   80488
## 5 China      1999  212258
## 6 China      2000  213766
```
]

---

## Ordenar datos a lo ancho

&lt;br&gt;

.pull-left[
.center[
&lt;img src="img/wider.png" width="600px"&gt;
]
]

.pull-right[
**`pivot_wider()`** es lo contrario de `pivot_longer()`, amplia los datos expandiendo dos columnas en varias. Una columna proporciona los nuevos nombres de columna, la otra los valores.


```r
pivot_wider(data, 
            names_from = "name",
            values_from = "value")
```
]

---

## Ordenar datos a lo ancho

.pull-left[

```r
table2
## # A tibble: 12 × 4
##    country      year type            count
##    &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;           &lt;int&gt;
##  1 Afghanistan  1999 cases             745
##  2 Afghanistan  1999 population   19987071
##  3 Afghanistan  2000 cases            2666
##  4 Afghanistan  2000 population   20595360
##  5 Brazil       1999 cases           37737
##  6 Brazil       1999 population  172006362
##  7 Brazil       2000 cases           80488
##  8 Brazil       2000 population  174504898
##  9 China        1999 cases          212258
## 10 China        1999 population 1272915272
## 11 China        2000 cases          213766
## 12 China        2000 population 1280428583
```
]

.pull-right[

```r
tabla2 %&gt;%  pivot_wider(names_from = tipo, 
                        values_from = cuenta)
## # A tibble: 6 × 4
##   pais        anio  casos  población
##   &lt;chr&gt;      &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afganistán  1999    745   19987071
## 2 Afganistán  2000   2666   20595360
## 3 Brasil      1999  37737  172006362
## 4 Brasil      2000  80488  174504898
## 5 China       1999 212258 1272915272
## 6 China       2000 213766 1280428583
```
]

---

background-color: var(--azul-claro)
class: middle, center, inverse

<svg aria-hidden="true" role="img" viewBox="0 0 640 512" style="height:3em;width:3.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M64 96c0-35.3 28.7-64 64-64H512c35.3 0 64 28.7 64 64V352H512V96H128V352H64V96zM0 403.2C0 392.6 8.6 384 19.2 384H620.8c10.6 0 19.2 8.6 19.2 19.2c0 42.4-34.4 76.8-76.8 76.8H76.8C34.4 480 0 445.6 0 403.2zM281 209l-31 31 31 31c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-48-48c-9.4-9.4-9.4-24.6 0-33.9l48-48c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9zM393 175l48 48c9.4 9.4 9.4 24.6 0 33.9l-48 48c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l31-31-31-31c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0z"/></svg>
## PRÁCTICA 2.4

---

## <svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M362.7 19.3L314.3 67.7 444.3 197.7l48.4-48.4c25-25 25-65.5 0-90.5L453.3 19.3c-25-25-65.5-25-90.5 0zm-71 71L58.6 323.5c-10.4 10.4-18 23.3-22.2 37.4L1 481.2C-1.5 489.7 .8 498.8 7 505s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L421.7 220.3 291.7 90.3z"/></svg> Práctica 2.4

1. ¿Qué tipo de pivoteo aplicarías al conjunto de datos `ventas` para que éste sea un data.frame ordenado? ¿Por qué?

2. Corrija el conjunto de datos.




---

class: middle, center, inverse

<svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:3em;width:3em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M352 320c88.4 0 160-71.6 160-160c0-15.3-2.2-30.1-6.2-44.2c-3.1-10.8-16.4-13.2-24.3-5.3l-76.8 76.8c-3 3-7.1 4.7-11.3 4.7H336c-8.8 0-16-7.2-16-16V118.6c0-4.2 1.7-8.3 4.7-11.3l76.8-76.8c7.9-7.9 5.4-21.2-5.3-24.3C382.1 2.2 367.3 0 352 0C263.6 0 192 71.6 192 160c0 19.1 3.4 37.5 9.5 54.5L19.9 396.1C7.2 408.8 0 426.1 0 444.1C0 481.6 30.4 512 67.9 512c18 0 35.3-7.2 48-19.9L297.5 310.5c17 6.2 35.4 9.5 54.5 9.5zM80 456c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg>
# Transformación de datos con `dplyr`

---

## Funciones del paquete `dplyr`

&lt;br&gt;
&lt;br&gt;

| Función        |  Acción                                    |
|:---------------|-------------------------------------------:|
| `rename()`     | *Modifica el nombre de las variables* |
| `select()`     | *Selecciona o descarta variables (columnas) de un conjunto de datos* |
| `filter()`     | *Filtra las observaciones (filas) de interés* |
| `mutate()`     | *Agrega o edita variables (columnas)* |
| `summarise()`  | *Resume los datos en tablas* |
| `group_by()`   | *Agrupa o segmenta los datos en función de una variable (columna)* |

&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;

.footnote[ [dplyr.tidyverse.org](https://dplyr.tidyverse.org/) ]

---

## Modificar el nombre de las variables

**`rename()`** se utiliza para cambiar el nombre de las variables. La función tiene el siguiente esquema:


```r
rename(data, columnas... )
```

Cambiando el nombre de las variables:


```r
colnames(ventas)
##  [1] "ANIO"             "MES"              "CODIGO_SECTOR_N1" "PROVINCIA"       
##  [5] "CANTON"           "TOTAL_COMPRAS"    "TOTAL_VENTAS"     "Fecha"           
##  [9] "DESCRIPCION"      "transaccion"      "monto"
```


```r
ventas &lt;- ventas %&gt;% rename(sector= DESCRIPCION,
                            anio=ANIO,
                            mes=MES,
                            provincia=PROVINCIA,
                            canton=CANTON)

colnames(ventas)
##  [1] "anio"             "mes"              "CODIGO_SECTOR_N1" "provincia"       
##  [5] "canton"           "TOTAL_COMPRAS"    "TOTAL_VENTAS"     "Fecha"           
##  [9] "sector"           "transaccion"      "monto"
```


---

## Seleccionar o descartar variables

**`select()`** permite seleccionar rápidamente un subconjunto útil utilizando operaciones basadas en los nombres de las variables. La función tiene el siguiente esquema:


```r
select(data, columnas... )
```


Selecciono las variables que deseo del conjunto de datos, mantendrá el orden que yo indique en la selección:


```r
ventas %&gt;% 
    select(Fecha, mes, provincia, canton, sector, transaccion, monto)
## # A tibble: 253,897 × 7
##    Fecha      mes   provincia canton     sector                   trans…¹  monto
##    &lt;date&gt;     &lt;fct&gt; &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;                    &lt;chr&gt;    &lt;dbl&gt;
##  1 2022-07-01 Jul   MANABI    24 DE MAYO CONSTRUCCIÓN.            VENTAS… 0     
##  2 2022-07-01 Jul   MANABI    24 DE MAYO CONSTRUCCIÓN.            VENTAS… 3.77e3
##  3 2022-07-01 Jul   MANABI    24 DE MAYO CONSTRUCCIÓN.            EXPORT… 0     
##  4 2022-07-01 Jul   MANABI    24 DE MAYO CONSTRUCCIÓN.            COMPRA… 1.94e4
##  5 2022-07-01 Jul   MANABI    24 DE MAYO CONSTRUCCIÓN.            COMPRA… 1.50e3
##  6 2022-07-01 Jul   MANABI    24 DE MAYO CONSTRUCCIÓN.            IMPORT… 0     
##  7 2022-07-01 Jul   MANABI    24 DE MAYO CONSTRUCCIÓN.            COMPRA… 0     
##  8 2022-04-01 Abr   EL ORO    MACHALA    COMERCIO AL POR MAYOR Y… VENTAS… 8.04e3
##  9 2022-04-01 Abr   EL ORO    MACHALA    COMERCIO AL POR MAYOR Y… VENTAS… 5.61e7
## 10 2022-04-01 Abr   EL ORO    MACHALA    COMERCIO AL POR MAYOR Y… EXPORT… 4.60e7
## # … with 253,887 more rows, and abbreviated variable name ¹​transaccion
```

---

## Seleccionar o descartar variables

Otra forma de seleccionar es _deseleccionando_ las variables que no deseo:

&lt;br&gt;


```r
ventas %&gt;% 
    select(-anio,-CODIGO_SECTOR_N1,-TOTAL_COMPRAS,-TOTAL_VENTAS)
## # A tibble: 253,897 × 7
##    mes   provincia canton     Fecha      sector                   trans…¹  monto
##    &lt;fct&gt; &lt;chr&gt;     &lt;chr&gt;      &lt;date&gt;     &lt;chr&gt;                    &lt;chr&gt;    &lt;dbl&gt;
##  1 Jul   MANABI    24 DE MAYO 2022-07-01 CONSTRUCCIÓN.            VENTAS… 0     
##  2 Jul   MANABI    24 DE MAYO 2022-07-01 CONSTRUCCIÓN.            VENTAS… 3.77e3
##  3 Jul   MANABI    24 DE MAYO 2022-07-01 CONSTRUCCIÓN.            EXPORT… 0     
##  4 Jul   MANABI    24 DE MAYO 2022-07-01 CONSTRUCCIÓN.            COMPRA… 1.94e4
##  5 Jul   MANABI    24 DE MAYO 2022-07-01 CONSTRUCCIÓN.            COMPRA… 1.50e3
##  6 Jul   MANABI    24 DE MAYO 2022-07-01 CONSTRUCCIÓN.            IMPORT… 0     
##  7 Jul   MANABI    24 DE MAYO 2022-07-01 CONSTRUCCIÓN.            COMPRA… 0     
##  8 Abr   EL ORO    MACHALA    2022-04-01 COMERCIO AL POR MAYOR Y… VENTAS… 8.04e3
##  9 Abr   EL ORO    MACHALA    2022-04-01 COMERCIO AL POR MAYOR Y… VENTAS… 5.61e7
## 10 Abr   EL ORO    MACHALA    2022-04-01 COMERCIO AL POR MAYOR Y… EXPORT… 4.60e7
## # … with 253,887 more rows, and abbreviated variable name ¹​transaccion
```



---

## Filtrar observaciones

Por si deseas combinar condiciones aquí tienes una lista de operadores de comparación y operadores lógicos:

.pull-left[

&lt;br&gt;
&lt;br&gt;

| Operadores de comparación     |  Acción    |
|:--------:|:--------------|
| == | igual |
| %in% | incluye |
| != | diferente |
| &gt; | mayor que |
| &gt;= | mayor o igual que |
| &lt; | menor que |
| &lt;= | menor o igual que |

]

.pull-right[

&lt;br&gt;
&lt;br&gt;

| Operadores lógicos     |  Acción    |
|:--------:|:--------------|
| &amp; | y - Cuando se cumplen ambas condiciones |
| &amp;#124; | o - Cuando se cumple una u otra condición |
]

---

## Filtrar observaciones

Vamos a delimitar el universo a las transacciones cuyo monto sea diferente de cero con **`filter()`**, es decir eliminaremos del conjunto de datos `ventas` cuyas transacciones sean igual a cero. 



```r
ventas &lt;- ventas %&gt;% filter(monto != 0)

str(ventas)
## tibble [127,444 × 7] (S3: tbl_df/tbl/data.frame)
##  $ Fecha      : Date[1:127444], format: "2022-07-01" "2022-07-01" ...
##  $ mes        : Factor w/ 12 levels "Ene","Feb","Mar",..: 7 7 7 4 4 4 4 4 4 4 ...
##  $ provincia  : chr [1:127444] "MANABI" "MANABI" "MANABI" "EL ORO" ...
##  $ canton     : chr [1:127444] "24 DE MAYO" "24 DE MAYO" "24 DE MAYO" "MACHALA" ...
##  $ sector     : chr [1:127444] "CONSTRUCCIÓN." "CONSTRUCCIÓN." "CONSTRUCCIÓN." "COMERCIO AL POR MAYOR Y AL POR MENOR; REPARACIÓN DE VEHÍCULOS AUTOMOTORES Y MOTOCICLETAS." ...
##  $ transaccion: chr [1:127444] "VENTAS_NETAS_TARIFA_0" "COMPRAS_ENTAS_TARIFA_12" "COMPRAS_NETAS_TARIFA_0" "VENTAS_NETAS_TARIFA_12" ...
##  $ monto      : num [1:127444] 3771 19373 1501 8036 56117439 ...
```


---

## Filtrar observaciones

Vamos a delimitar nuestros datos a las transacciones por concepto de exportaciones e importaciones.


```r
ventas %&gt;% 
    filter(transaccion %in% c("EXPORTACIONES", "IMPORTACIONES"))
## # A tibble: 9,875 × 7
##    Fecha      mes   provincia  canton         sector              trans…¹  monto
##    &lt;date&gt;     &lt;fct&gt; &lt;chr&gt;      &lt;chr&gt;          &lt;chr&gt;               &lt;chr&gt;    &lt;dbl&gt;
##  1 2022-04-01 Abr   EL ORO     "MACHALA"      COMERCIO AL POR MA… EXPORT… 4.60e7
##  2 2022-04-01 Abr   EL ORO     "MACHALA"      COMERCIO AL POR MA… IMPORT… 6.62e6
##  3 2022-07-01 Jul   GUAYAS     "GUAYAQUIL"    COMERCIO AL POR MA… EXPORT… 2.51e8
##  4 2022-07-01 Jul   GUAYAS     "GUAYAQUIL"    COMERCIO AL POR MA… IMPORT… 4.60e8
##  5 2022-01-01 Ene   TUNGURAHUA "AMBATO"       CONSTRUCCIÓN.       IMPORT… 7.02e5
##  6 2022-03-01 Mar   PICHINCHA  "QUITO"        BAJO RELACION DE D… EXPORT… 1.07e6
##  7 2022-03-01 Mar   PICHINCHA  "QUITO"        BAJO RELACION DE D… IMPORT… 7.36e6
##  8 2022-09-01 Sep   PICHINCHA  "RUMI\xd1AHUI" INFORMACIÓN Y COMU… EXPORT… 1.36e4
##  9 2022-09-01 Sep   PICHINCHA  "RUMI\xd1AHUI" INFORMACIÓN Y COMU… IMPORT… 3.25e5
## 10 2022-03-01 Mar   PICHINCHA  "QUITO"        CONSTRUCCIÓN.       EXPORT… 2.90e5
## # … with 9,865 more rows, and abbreviated variable name ¹​transaccion
```

---

## Filtrar observaciones

Vamos a delimitar nuestros datos a las transacciones por concepto de exportaciones e importaciones de la provincia del Pichincha.


```r
ventas %&gt;% 
    filter((transaccion %in% c("EXPORTACIONES", "IMPORTACIONES")) &amp; 
               provincia=="PICHINCHA")
## # A tibble: 998 × 7
##    Fecha      mes   provincia canton         sector               trans…¹  monto
##    &lt;date&gt;     &lt;fct&gt; &lt;chr&gt;     &lt;chr&gt;          &lt;chr&gt;                &lt;chr&gt;    &lt;dbl&gt;
##  1 2022-03-01 Mar   PICHINCHA "QUITO"        BAJO RELACION DE DE… EXPORT… 1.07e6
##  2 2022-03-01 Mar   PICHINCHA "QUITO"        BAJO RELACION DE DE… IMPORT… 7.36e6
##  3 2022-09-01 Sep   PICHINCHA "RUMI\xd1AHUI" INFORMACIÓN Y COMUN… EXPORT… 1.36e4
##  4 2022-09-01 Sep   PICHINCHA "RUMI\xd1AHUI" INFORMACIÓN Y COMUN… IMPORT… 3.25e5
##  5 2022-03-01 Mar   PICHINCHA "QUITO"        CONSTRUCCIÓN.        EXPORT… 2.90e5
##  6 2022-03-01 Mar   PICHINCHA "QUITO"        CONSTRUCCIÓN.        IMPORT… 7.11e6
##  7 2022-04-01 Abr   PICHINCHA "QUITO"        ACTIVIDADES FINANCI… EXPORT… 1.63e6
##  8 2022-04-01 Abr   PICHINCHA "QUITO"        ACTIVIDADES FINANCI… IMPORT… 1.08e4
##  9 2022-07-01 Jul   PICHINCHA "QUITO"        BAJO RELACION DE DE… EXPORT… 6.85e5
## 10 2022-07-01 Jul   PICHINCHA "QUITO"        BAJO RELACION DE DE… IMPORT… 9.76e6
## # … with 988 more rows, and abbreviated variable name ¹​transaccion
```

---

## Filtrar observaciones

Vamos a delimitar nuestros datos a las transacciones por concepto de exportaciones e importaciones de la provincia del Pichincha cuyos montos sean mayores a `\(600,000\)`.


```r
ventas %&gt;% 
    filter((transaccion %in% c("EXPORTACIONES", "IMPORTACIONES")) &amp; 
               provincia=="PICHINCHA" &amp;
               monto &gt; 600000)
## # A tibble: 353 × 7
##    Fecha      mes   provincia canton sector                       trans…¹  monto
##    &lt;date&gt;     &lt;fct&gt; &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;                        &lt;chr&gt;    &lt;dbl&gt;
##  1 2022-03-01 Mar   PICHINCHA QUITO  BAJO RELACION DE DEPENDENCI… EXPORT… 1.07e6
##  2 2022-03-01 Mar   PICHINCHA QUITO  BAJO RELACION DE DEPENDENCI… IMPORT… 7.36e6
##  3 2022-03-01 Mar   PICHINCHA QUITO  CONSTRUCCIÓN.                IMPORT… 7.11e6
##  4 2022-04-01 Abr   PICHINCHA QUITO  ACTIVIDADES FINANCIERAS Y D… EXPORT… 1.63e6
##  5 2022-07-01 Jul   PICHINCHA QUITO  BAJO RELACION DE DEPENDENCI… EXPORT… 6.85e5
##  6 2022-07-01 Jul   PICHINCHA QUITO  BAJO RELACION DE DEPENDENCI… IMPORT… 9.76e6
##  7 2022-04-01 Abr   PICHINCHA QUITO  ACTIVIDADES DE ATENCIÓN DE … EXPORT… 6.25e5
##  8 2022-02-01 Feb   PICHINCHA QUITO  COMERCIO AL POR MAYOR Y AL … EXPORT… 3.24e7
##  9 2022-02-01 Feb   PICHINCHA QUITO  COMERCIO AL POR MAYOR Y AL … IMPORT… 4.74e8
## 10 2022-07-01 Jul   PICHINCHA QUITO  COMERCIO AL POR MAYOR Y AL … EXPORT… 3.57e7
## # … with 343 more rows, and abbreviated variable name ¹​transaccion
```

---

## Agregar o editar variables

Con **`mutate()`** agregaremos una columna que contenga el monto del IVA de compras y ventas gravados con 12\%, de acuerdo a las transacciones. Para efectuar este requerimiento necesitamos conocer 2 nuevas funciones:

* `case_when()` Permite definir una variable, de forma tal que tome un valor particular para cada condición establecida. En caso de no cumplir con ninguna de las condiciones establecidas, la variable tomará valor `NA`. La sintaxis de la función es:


```r
# Valores no especificados por default NA
case_when(condicion_logica1 ~ valor asignado1,
          condicion_logica2 ~ valor asignado2)

# Se pueden especificar condiciones restantes
case_when(condicion_logica1 ~ valor asignado1,
          condicion_logica2 ~ valor asignado2,
          TRUE ~ valor asignado3)
```

* `round()` redondeo valores numéricos. La sintaxis de la función es:


```r
# Valores no especificados por default NA
round(valor_numerico, numero_decimales)
```

---

## Agregar o editar variables

¡AHORA SÍ! Con **`mutate()`** agregaremos una columna que contenga el monto del IVA de compras y ventas gravados con 12\%, de acuerdo a las transacciones.


```r
ventas %&gt;% 
    mutate(IVA = case_when(transaccion=="COMPRAS_ENTAS_TARIFA_12" ~ round((monto*0.12),2),
                           transaccion=="VENTAS_NETAS_TARIFA_12" ~ round((monto*0.12),2),
                           TRUE ~ 0))
## # A tibble: 127,444 × 8
##    Fecha      mes   provincia canton     sector            trans…¹  monto    IVA
##    &lt;date&gt;     &lt;fct&gt; &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;             &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;
##  1 2022-07-01 Jul   MANABI    24 DE MAYO CONSTRUCCIÓN.     VENTAS… 3.77e3 0     
##  2 2022-07-01 Jul   MANABI    24 DE MAYO CONSTRUCCIÓN.     COMPRA… 1.94e4 2.32e3
##  3 2022-07-01 Jul   MANABI    24 DE MAYO CONSTRUCCIÓN.     COMPRA… 1.50e3 0     
##  4 2022-04-01 Abr   EL ORO    MACHALA    COMERCIO AL POR … VENTAS… 8.04e3 9.64e2
##  5 2022-04-01 Abr   EL ORO    MACHALA    COMERCIO AL POR … VENTAS… 5.61e7 0     
##  6 2022-04-01 Abr   EL ORO    MACHALA    COMERCIO AL POR … EXPORT… 4.60e7 0     
##  7 2022-04-01 Abr   EL ORO    MACHALA    COMERCIO AL POR … COMPRA… 4.34e7 5.20e6
##  8 2022-04-01 Abr   EL ORO    MACHALA    COMERCIO AL POR … COMPRA… 8.83e7 0     
##  9 2022-04-01 Abr   EL ORO    MACHALA    COMERCIO AL POR … IMPORT… 6.62e6 0     
## 10 2022-04-01 Abr   EL ORO    MACHALA    COMERCIO AL POR … COMPRA… 6.88e5 0     
## # … with 127,434 more rows, and abbreviated variable name ¹​transaccion
```



---


class: middle, center, inverse

&lt;br&gt;
&lt;br&gt;

# Importación y Manipulación de Datos en R
## **CAPÍTULO 2**

&lt;br&gt;
&lt;br&gt;

.center[
### [@MasappEC <svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>](https://www.facebook.com/MasappEC/)

### [@Masappdata <svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>](https://twitter.com/Masappdata)
]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://platform.twitter.com/widgets.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
