---
title: "Sección 3: Estructuras de Datos en R"
subtitle: "PROGRAMA INTERNACIONAL DE ESTADÍSTICA APLICADA A LA INVESTIGACIÓN CIENTÍFICA" 
author: "MÓDULO: SOFTWARES PARA EL MANEJO DE DATOS <br> <br> Linda Cabrera Orellana"
date: "Marzo, 2023"
output:
    xaringan::moon_reader:
        css: see-theme2E.css
        lib_dir: libs
        seal: false
        nature:
          highlightStyle: github
          highlightLines: true
          countIncrementalSlides: false
          ratio: "16:9"
          beforeInit: "https://platform.twitter.com/widgets.js"
---


```{r configuracion, include = FALSE}
library(knitr)
library(tidyverse)
library(fontawesome)       #viñetas
library(xaringanExtra)
# set default options
opts_chunk$set(echo=FALSE,
               warning=FALSE,
               collapse = TRUE,
               dpi = 200)
knit_engines$set("yaml", "markdown")

xaringanExtra::use_tile_view()
xaringanExtra::use_clipboard()
xaringanExtra::use_share_again()
xaringanExtra::style_share_again(
  share_buttons = c("twitter", "linkedin", "pocket")
)
```

class: center, middle, titular
background-size: contain

<img src="img/see.png" width="250px"/>
# `r rmarkdown::metadata$title` 
## **`r rmarkdown::metadata$subtitle`**
#### `r rmarkdown::metadata$author`
#### `r rmarkdown::metadata$date`


---

```{r xaringan-panelset, echo=FALSE}
xaringanExtra::use_panelset()
```

class: middle, center, inverse

`r fontawesome::fa("file-import", height = "3em")`
# Importar datos


---

# `r fontawesome::fa("file-csv")` Importar archivos `.csv`

.pull-left[

.center[
<img src="img/readr.png" width="200px">
]

`readr` lee datos rectangulares de archivos delimitados, como valores separados por comas (CSV) y valores separados por tabuladores (TSV).

]

.pull-right[

Para leer un archivo `.csv` la función a utilizar es `read_csv()` del paquete `readr` que es parte del `tidyverse`. Para cargar nuestro archivo:

```{r csv2, echo=TRUE, eval=FALSE, warning=TRUE}
library(readr)
players21 <- read_csv("data/CSVplayers_21.csv")
```

También lo podemos hacer con el sistema base de `r fontawesome::fa("r-project")`, aquí no necesitamos cargar ninguna librería. Para esto, nos ubicamos en la barra de herramientas `File -> Import Dataset -> From Text (readr)`.

]

.footnote[ [readr.tidyverse.org](https://readr.tidyverse.org/) ]


---

# `r fontawesome::fa("file-excel")` Importar desde Excel

.pull-left[

.center[
<img src="img/readxl.png" width="200px">
]

`readxl` facilita la transferencia de datos de Excel a R y está diseñado para trabajar con datos tabulares. Admite tanto el formato `.xls` heredado como el formato `.xlsx` moderno basado en `xml`.

]


.pull-right[

Para leer un archivo de Excel la función a utilizar es `read_excel()` del paquete `readxl` que es parte del `tidyverse`. Para cargar nuestro archivo:

```{r exc2, echo=TRUE, eval=FALSE}
library(readxl)
profesores <- read_excel("data/EXCELprofesores.xlsx", 
    sheet = "DATA", skip = 1)
```

```{r exc3, echo=FALSE, warning=FALSE, message=FALSE}
library(readxl)
profesores <- read_excel("data/EXCELprofesores.xlsx", 
    sheet = "DATA", skip = 1)
```

También lo podemos hacer con el sistema base de `r fontawesome::fa("r-project")`, aquí no necesitamos cargar ninguna librería. Para esto, nos ubicamos en la barra de herramientas `File -> Import Dataset -> From Excel...`.

]

.footnote[ [readxl.tidyverse.org](https://readxl.tidyverse.org/) ]

---

# `r fontawesome::fa("file-excel")` Importar desde SPSS y STATA

.pull-left[

.center[
<img src="img/haven.png" width="200px">
]

`haven` permite que R lea y escriba varios formatos de datos utilizados por otros paquetes estadísticos al envolver la fantástica biblioteca ReadStat C escrita por Evan Miller. `haven` es parte del `tidyverse`.

]


.pull-right[

.panelset[
.panel[.panel-name[SPSS]
## **SPSS**
Para leer un archivo de SPSS la función a utilizar es `read_sav()` del paquete `haven` que es parte del `tidyverse`. Para cargar nuestro archivo:

```{r hav1, echo=TRUE, eval=FALSE, warning=TRUE}
library(haven)
estres <- read_sav("data/SPSSestres.sav")
```
]

.panel[.panel-name[STATA]
## **STATA**
Para leer un archivo de STATA la función a utilizar es `read_dta()` del paquete `haven` que es parte del `tidyverse`. Para cargar nuestro archivo:

```{r hav2, echo=TRUE, eval=FALSE, warning=TRUE}
library(haven)
pasajeros <- read_dta("data/STATApasajeros.dta")
```
]
]
]

.footnote[ [haven.tidyverse.org](https://haven.tidyverse.org/) ]

<!--

# `r fontawesome::fa("battle-net")` Importar desde la web

.pull-left[

.center[
<img src="img/rio.png" width="200px">
]

`rio` realiza importación y exportación optimizada de datos. Usa la extensión de archivo de un nombre de archivo para determinar qué tipo de archivo es. 

]

.pull-right[

En esta ocasión leeremos información disponible en la web del [Banco Central del Ecuador](https://www.bce.fin.ec/).

```{r rio1, echo=TRUE, eval=FALSE}
library(rio)
# Data del Banco Central del Ecuador

# Para guardar la url de descarga en una variable
urlData <- "https://contenido.bce.fin.ec/documentos/Estadisticas/SectorReal/CuentasProvinciales/Can2020.xlsm" 

# Para importar los datos de la url, escogemos la pestaña
# sheet: pestaña del documento
# skip: número de filas omitidas
# col_names: desea nombre de columnas sea la primera fila
dataBCE <- import(urlData, sheet = "VAB Cantonal", skip = 6, col_names = TRUE)

```
]

.footnote[ [github.com/leeper/rio](https://github.com/leeper/rio) ]


# `r fontawesome::fa("file")` Otros archivos

* **Excel:** Usando el paquete `openxlsx` con
`read.xlsx(xlsxFile , sheet , startRow , colNames , skipEmptyRows, rowNames)`

* `foreign` para cargar archivos de SAS, SPSS, Stata: SAS (`read.xport()`), SPSS (`read.spss()`), Stata (`read.dta()`).

* GIS sistemas de información geográfica con `rgal` y `raster`.

* `GoogleSpreadSheets` con googlesheets.

* `data.table` para manejar grandes volúmenes de datos. Existe un curso corto gratuito brindado por la Sociedad Ecuatoriana de Estadística que pueden visitar en el siguiente link: [https://www.youtube.com/Sociedad_Ecuatoriana_Estadistica](https://www.youtube.com/watch?v=s1QnGTk0x8U&list=PL2PpISw8vp_oJlVXpYYowclogCCLtEOfX).

-->

---

class: middle, center, inverse

`r fontawesome::fa("object-group", height = "3em")`
# Estructuras de Datos

---

background-image: url("img/estructuras.png")
background-size: contain

# `r fontawesome::fa("object-group")` Estructuras de Datos

---

# `r fontawesome::fa("vector-square")` Vectores

.pull-left[
El tipo de dato fundamental en R es el vector. Un vector es una secuencia de elementos de datos todos del mismo tipo.

Creamos un vector de dimensión 1:

```{r vect, echo=TRUE}
x <- 4
is.vector(x)        #¿es vector?
```

Hay varias formas de crear vectores, pero una de las más comunes es el operador de concatenación `c()`. 
]


.pull-right[
A continuación creamos un vector de 4 elementos de tipo numérico:

```{r vect2, echo=TRUE}
y <- c(11, 13, 15, 20)
y                   #para imprimir vector
is.vector(y)
```

También podemos crear un vector de tipo caracter de 4 elementos:

```{r vect3, echo=TRUE}
z <- c("1", "5", "11", "14")
z
is.vector(z)
```
]

---

# `r fontawesome::fa("vector-square")` Vectores

.pull-left[
También podemos realizar operaciones entre vectores de la misma dimensión:

```{r vect4, echo=TRUE}
w <- c(2, 5, 6, 8)
w

y + 2*w - 3
```

Para conocer la longitud de un vector usamos `length()`.

```{r vect5, echo=TRUE}
length(y)
```
]

.pull-right[

¿Qué sucede cuando el vector no tiene el mismo tipo de datos? Esto se denomina _coerción de tipos de datos_ y es motivo de muchas sorpresas y la razón por la cual es necesario conocer los tipos de datos básicos y cómo R los interpreta. Cuando R encuentra una mezcla de tipos de datos (en este caso numeric y character) para combinarlos en un vector, va a forzarlos a ser del mismo tipo.

```{r vect6, echo=TRUE}
otro_vector <- c(2,6,'3')

otro_vector
```

]

---

# `r fontawesome::fa("vector-square")` Vectores

.pull-left[
Podemos llamar elementos específicos de un vector usando la **indexación**. Por ejemplo:

* `x[]` es una forma de llamar a un elemento específico de un vector.
* `x[1]` es el primer elemento.
* `x[3]` es el tercer elemento.
* `x[-3]` es un vector con todo menos el tercer elemento.

Vamos a intentar indexar los vectores que tenemos:

```{r vect7, echo=TRUE}
# reviso los elementos que contiene el vector w
w     

# extraigo el segundo elemento del vector w
w[2]    
```
]

.pull-right[
Para eliminar elementos del vector:

```{r vect8, echo=TRUE}
# imprimo el vector w, excepto su tercer elemento
w[-3]   
```

Indexamos un conjunto de elementos a la vez, para esto creamos un vector de mayor longitud denominado `secuencia`:

```{r vect9, echo=TRUE}
# genero múltiplos de 3 hasta el 30
secuencia <- seq(3, 30, 3)
secuencia

# seleccionar todos los múltiplos excepto el 3 y el 30
secuencia[2:9]
```

]

---

# `r fontawesome::fa("vector-square")` Vectores

```{r vect10, echo=TRUE}
# seleccionar los elementos que están en la posición del 3 al 6 y el que está en la posición 8
secuencia[c(3:6, 8)]
```

Vamos a intentar indexar usan **operadores lógicos**:

```{r vect11, echo=TRUE}
## Elegir los números mayores a 30
secuencia > 30          # las posiciones TRUE son los que contienen números mayores a 30
secuencia[secuencia > 30]   # regresa los números en las posiciones TRUE

## Combinar operadores lógicos
## Elegir los números menores a 25 y mayores a 10
secuencia < 25
secuencia > 10
secuencia < 25 & secuencia > 10
secuencia[secuencia < 25 & secuencia > 10]
```


---

# `r fontawesome::fa("table")` Data.frames

.pull-left[
Un data frame es un conjunto de vectores que deben cumplir las siguientes propiedades:
* Las componentes son vectores
* Cada vector puede ser de un tipo de dato distinto
* Cada columna es una variable
* Las columnas tienen el mismo largo

Las filas se denominan observaciones y las columnas se las denomina variables.
]

.pull-right[
.center[
<img src="img/dataframe.png" width="700px">
Artwork by @allison_horst
]
]

---

.pull-left[
## `r fontawesome::fa("table")` Crear un data.frame

Con la función `data.frame()`, que se conformará de la unión de 3 vectores creados previamente.

```{r df1, echo=TRUE}
nombres <- c("Marcela Cox", "Luis Vargas", "David Mieles")
edades <- c(24,32,27)
seguro <- factor(c("IESS", "BMI", "IESS"))

pacientes <- data.frame(nombres, edades, seguro)
pacientes
```

Ver objeto creado en el panel `Environment`.
]


.pull-right[
## `r fontawesome::fa("table")` Cambiar nombre de columnas

* Desde la creación del data.frame:

```{r df2, echo=TRUE}
pacientes2 <- data.frame(N1=nombres, N2=edades, seguro)
pacientes2
```

* En un data.frame existente con `names()`:

```{r df3, echo=TRUE}
names(pacientes2) <- c("Name", "Age", "Insurance")
pacientes2
```
]

---

.pull-left[
## `r fontawesome::fa("table")` Navegando por el data.frame

Supongamos que queremos extraer la edad de David Mieles. (indexación)

```{r df4, echo=TRUE}
pacientes[3,2]
```

.center[
<img src="img/dataframe2.png" width="750px">
]

]

.pull-right[
Podemos seleccionar varias columnas y filas a la vez con `:`.

```{r df5, echo=TRUE}
## seleccionar las 2 últimas columnas y las 2 primeras filas
pacientes[1:2, 2:3]
```

También podemos consultar a R por los valores de una columna entera de nuestro data set con el símbolo `$`.

```{r df6, echo=TRUE}
## seleccionar la columna nombres
pacientes$nombres
```

Y aplicar una función a esa columna:

```{r df7, echo=TRUE}
## calcular el promedio de las edades
mean(pacientes$edades)
```

]

.footnote[ [tibble.tidyverse.org](https://tibble.tidyverse.org/) ]

---

## `r fontawesome::fa("object-group")` Funciones básicas para explorar data.frames

.pull-left[
* **`dim():`** indica las dimensiones del data.frame o tibble, número de filas y columnas.

* **`str():`** muestra de forma compacta la estructura interna de un objeto R.

* **`colnames():`** muestra el nombre de las variables de un data.frame.

* **`head():`** muestra las 10 primeras obervaciones del conjunto de datos.

* **`tail():`** muestra las 4 últimas observaciones del conjunto de datos.
]

.pull-right[
* **`summary():`** produce resúmenes de resultados de varias variables. Los resultados dependen de la clase de datos.

* **`sum():`** devuelve la suma de todos los valores presentes en sus argumentos.

* **`min():`** devuelve el valor mínimo de un vector numérico.

* **`max():`** devuelve el valor máximo de un vector numérico.
]

---

## `r fontawesome::fa("object-group")` Funciones básicas para explorar data.frames

.panelset[
.panel[.panel-name[Encuestados]
¿Cuántas personas llenaron la encuesta de la situación actual del profesorado de alumnos con necesidades especiales educativas?

```{r fb1, echo=TRUE}
dim(profesores)
```
]

.panel[.panel-name[Encuesta]

¿Cuál es la estructura de la encuesta de la situación actual del profesorado de alumnos con necesidades especiales educativas?

```{r fb2, echo=TRUE}
str(profesores)
```
]

.panel[.panel-name[Variables]

¿Cuáles son las variables de la encuesta de la situación actual del profesorado de alumnos con necesidades especiales educativas?

```{r fb3, echo=TRUE}
colnames(profesores)
```
]

.panel[.panel-name[Primeros]

Visualización de las primeras 5 encuestas realizadas al profesorado sobre la situación actual de alumnos con necesidades especiales educativas

```{r fb4, echo=TRUE}
head(profesores, n=5)
```
]

.panel[.panel-name[Últimos]

Visualización de las últimas 5 encuestas realizadas al profesorado sobre la situación actual de alumnos con necesidades especiales educativas

```{r fb5, echo=TRUE}
tail(profesores, n=5)
```
]

.panel[.panel-name[Total]

¿Cuántos alumnos con necesidades especiales educativas constan en la encuesta?

```{r fb6, echo=TRUE}
sum(profesores$alumnos_NEE)
```
]

.panel[.panel-name[Min]

¿Cuál es la edad del profesor más joven que llenó la encuesta de la situación actual del profesorado de alumnos con necesidades especiales educativas?

```{r fb7, echo=TRUE}
min(profesores$edad)
```
]

.panel[.panel-name[Max]

¿Cuál es la edad del profesor mayor que llenó la encuesta de la situación actual del profesorado de alumnos con necesidades especiales educativas?

```{r fb8, echo=TRUE}
max(profesores$edad)
```
]

.panel[.panel-name[Resumen]
Genere un resumen de la variable `alumnos` de la encuesta de la situación actual del profesorado de alumnos con necesidades especiales educativas.

```{r fb9, echo=TRUE}
summary(profesores$alumnos)
```
]

]

---

# `r fontawesome::fa("vector-square")` Listas

.pull-left[
Una lista es más simple en algunos aspectos que los otros tipos, porque puedes poner cualquier cosa que tú quieras en ella utilizando la función `list()`:

```{r lista1, echo=TRUE}
lista <- list(1, "a", TRUE, 1+4i)
lista
```

]


.pull-right[

Observemos que los elementos de la lista se enumeran por sí solos, aunque también puedes darle nombre a cada elemento:

```{r lista2, echo=TRUE}
otra_lista <- list(title = "Numbers", numbers = 1:10, data = TRUE )
otra_lista
```

]


---

# `r fontawesome::fa("vector-square")` Listas


```{r lista3, echo=TRUE}
# [] muestra nombre y contenido del elemento 2
lista[2]

otra_lista[2]

# [[]] muestra el contenido del elemento 2
lista[[2]]

otra_lista[[2]]

# [[]][] muestra el contenido que está en la 4ta posición del elemento 2
otra_lista[[2]][4]
```


---

background-color: var(--azul-claro)
class: middle, center, inverse

`r fontawesome::fa("laptop-code", height = "3em")`
## PRÁCTICA

---

# `r fontawesome::fa("pen")` Práctica: ¡5 minutos!


1. Del conjunto de datos `profesores`:

   1. Extraer toda la información del 6to encuestado.
   
   2. Extraer la siguiente información del 5to encuestado: edad, sexo, nivel y tiempo.
   
   3. Extrar toda la información de los encuentados que tienen 10 años o más ejerciendo la docencia.
   
   4. Extraer el id, sexo y nivel de los profesores encuestados mayores a 40 años que estén Totalmente de acuerdo (5) que las clases serían mejor con un asistente en clase a tiempo completo.



---

class: middle, center, inverse

<br>
<br>

# Estructuras de Datos en R
### Linda Cabrera Orellana

.pull-left[
.center[
### [@socecuest `r fontawesome::fa("facebook")`](https://www.facebook.com/socecuest)

### [@see_estadistica `r fontawesome::fa("instagram")`](https://www.instagram.com/see_estadistica/)
]]

.pull-right[
.center[
### [@see_estadistica `r fontawesome::fa("twitter")`](https://twitter.com/see_estadistica)

### [@sosecuest `r fontawesome::fa("telegram")`](https://t.me/sosecuest)
]]

